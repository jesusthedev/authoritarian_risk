<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Review Queue</title><script src="https://cdn.tailwindcss.com"></script><link rel="stylesheet" href="../styles.css"/></head>
<body class="bg-zinc-950 text-zinc-100">
  <main class="max-w-6xl mx-auto px-4 py-8 space-y-6">
    <a href="../index.html" class="text-sm text-zinc-400">← Back to Dashboard</a>
    <h1 class="text-2xl font-semibold">Review Queue</h1>
    <p class="text-zinc-300">RSS-ingested items land here. Use Export to create JSON for PR into <code>data.json</code>.</p>
    <div class="flex gap-2">
      <input id="q" placeholder="Filter…" class="input"/>
      <button id="exportSel" class="btn btn-primary">Export selected → JSON</button>
    </div>
    <div id="list" class="grid md:grid-cols-2 gap-3 mt-4"></div>
  </main>
  <script>
    const $=s=>document.querySelector(s);
    const list=$('#list'); let items=[];
    async function load(){ const res=await fetch('../data/review_queue.json?_='+Date.now()); items=await res.json(); render(); }
    function render(){
      const q=$('#q').value?.toLowerCase()||''; list.innerHTML='';
      for(const it of items){
        if(q && !(`${it.title} ${it.summary} ${it.source}`).toLowerCase().includes(q)) continue;
        const card=document.createElement('div'); card.className='card';
        card.innerHTML=`<label class="flex items-start gap-3"><input type="checkbox" data-id="${it.id}" class="mt-1"/><div><div class="font-semibold">${it.title}</div><div class="text-xs text-zinc-400">${it.source} • ${new Date(it.date).toISOString().slice(0,10)}</div><p class="text-sm mt-1 text-zinc-300">${it.summary||''}</p><a class="table-link" href="${it.url}" target="_blank" rel="noopener">Open source</a></div></label>`;
        list.appendChild(card);
      }
    }
    document.getElementById('q').addEventListener('input', render);
    document.getElementById('exportSel').addEventListener('click',()=>{
      const ids=[...document.querySelectorAll('input[type="checkbox"]:checked')].map(x=>x.dataset.id);
      const sel=items.filter(it=>ids.includes(it.id)).map(it=>({
        id: crypto.randomUUID(), date: it.date, category: 'propaganda', title: it.title, severity: 'medium', impact: 0.5,
        source_outlet: it.source, source_url: it.url, summary: it.summary||''
      }));
      const blob=new Blob([JSON.stringify(sel,null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='review-promoted.json'; a.click(); URL.revokeObjectURL(a.href);
    });
    load();
  </script>
</body></html>